!function(e){e.module("slpaVideoPlayer.config",[]).value("slpaVideoPlayer.config",{debug:!0}),e.module("slpaVideoPlayer",["ngMaterial","blockUI","ngStorage","slpaVideoPlayer.config","slpaVideoPlayer.directives","slpaVideoPlayer.filters","slpaVideoPlayer.services"])}(angular),angular.module("slpaVideoPlayer.directives",[]).directive("clip",function(){return{scope:{videosource:"="},restrict:"AE",replace:!0,template:' <md-card><div layout="row"><div flex ="66"><md-card><div block-ui="myBlock"><div class=" card-media"><video id="player" src="{{videosource}}" pause-video loaded-data muted autoplay autobuffer controls></video></div></div><md-card-content ng-show="true"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm><label>Clip name</label><input  ng-model="clip.name"></md-input-container><md-input-container class="md-block" flex-gt-sm><label>Start time</label><input type="number" ng-model="clip.startTime"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm><md-switch ng-model="clip.persist">Persist</md-switch></md-input-container><md-input-container class="md-block" flex-gt-sm><label>End Time</label><input type="number" ng-model="clip.endTime"></md-input-container></div></md-card-content><md-card-actions layout="row" layout-align="end center"><md-button class="md-raised md-accient" ng-click="saveClip()">Guardar</md-button><md-button class="md-raised md-primary" ng-click="resetClip()">Nuevo</md-button></md-card-actions></md-card></div><div flex="33"><md-content flex  layout-padding><md-list><md-list-item class="md-3-line secondary-button-padding" ng-repeat="item in clips track by $index"ng-click="setSource(item,$index)"><img src="images/poster.jpg" class="md-avatar"/><div class="md-list-item-text" layout="column"><h3>{{ item.name }}</h3><p>Start ({{ item.startTime|secondsToHHmmss }}) -  End ({{item.endTime|secondsToHHmmss}})</p><md-button class="md-secondary md-accent md-raised" ng-show="$index!=0" ng-click="deleteClip($index)">Delete</md-button></div></md-list-item><md-divider ></md-divider></md-list></md-content></div></div></md-card>',controller:function(e,i,l,n,t){function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function d(i){if(-1!==e.$storage.clips.indexOf(i)){var l=e.$storage.clips.indexOf(i);i.persist===!1?e.clips.splice(l,1):e.$storage.clips[l]=i}else e.$storage.clips.push(i)}e.videosourceOrigin=e.videosource;var s=n.instances.get("myBlock");e.$storage=t.$default({clips:[]}),e.resetClip=function(){e.clip={id:null,name:null,startTime:null,endTime:null,source:null,playFragment:null,persist:null},e.new=!0},e.new=!0,e.clip={id:null,name:null,startTime:null,endTime:null,source:null,playFragment:null,persist:null},e.clips=[],angular.element("#player").bind("loadeddata",function(){e.videoDuration=angular.element("#player")[0].duration,e.clips[0].endTime=e.videoDuration}),angular.element("#player").on("pause",function(){var i=e.clips.indexOf(e.clip);i<e.clips.length&&angular.element("#player")[0].currentTime-e.clip.endTime>.1&&(s.start("Loading next clip.."),l(function(){s.stop(),e.videosource=e.clips[i+1].playFragment},3e3))}),e.clips.push({name:"Full Video",startTime:0,endTime:e.videoDuration,source:e.videosourceOrigin,playFragment:e.videosourceOrigin}),e.saveClip=function(){e.clip.source=e.videosource,e.clip.playFragment=e.videosourceOrigin+"#t="+e.clip.startTime+","+e.clip.endTime,e.new===!0&&(e.clip.id=a(),e.clips.push(e.clip),e.clip.persist===!0&&d(e.clip),e.resetClip()),e.clip.persist===!0&&d(e.clip)},e.deleteClip=function(i){e.clip.persist===!1&&d(e.clip),e.clips.splice(i,1),e.resetClip()},e.setSource=function(i,l){e.videosource=i.playFragment,0!==l?(e.clip=i,e.new=!1):e.resetClip()}},link:function(e){e.$watch("color",function(){console.log("changed detected")})}}}),angular.module("slpaVideoPlayer.services",[]).factory("localData",function(){}),angular.module("slpaVideoPlayer.filters",[]).filter("secondsToHHmmss",function(e){return function(i){return e("date")(new Date(0,0,0).setSeconds(i),"HH:mm:ss")}});