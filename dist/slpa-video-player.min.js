!function(e){e.module("slpaVideoPlayer.config",[]).value("slpaVideoPlayer.config",{debug:!0}),e.module("slpaVideoPlayer",["ngMaterial","blockUI","ngStorage","cfp.hotkeys","slpaVideoPlayer.config","slpaVideoPlayer.directives","slpaVideoPlayer.filters","slpaVideoPlayer.services"])}(angular),angular.module("slpaVideoPlayer.directives",[]).directive("clip",function(){return{scope:{videosource:"@"},restrict:"AE",replace:!0,template:' <md-card><div layout="row"><div flex ="66"><md-card><div block-ui="myBlock"><div class=" card-media"><video id="player" src="{{videosource | trustUrl}}" pause-video loaded-data muted autoplay autobuffer controls style="width: 100%!important;height: auto !important"></video></div></div><md-card-content ng-show="true"><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm><label>Clip name</label><input  ng-model="clip.name"></md-input-container><md-input-container class="md-block" flex-gt-sm><label>Start time</label><input type="number" ng-model="clip.startTime"></md-input-container></div><div layout-gt-sm="row"><md-input-container class="md-block" flex-gt-sm><md-switch ng-model="clip.persist">Persist</md-switch></md-input-container><md-input-container class="md-block" flex-gt-sm><label>End Time</label><input type="number" ng-model="clip.endTime"></md-input-container></div></md-card-content><md-fab-toolbar md-open="false" count="demo.count"md-direction="left"><md-fab-trigger class="align-with-text"><md-button aria-label="menu" class="md-fab md-primary"><md-icon class="material-icons md-light md-48"> menu </md-icon></md-button></md-fab-trigger><md-toolbar><md-fab-actions class="md-toolbar-tools"><md-button class="md-accent md-raised" ng-click="deleteClip()" ng-hide="new">Eliminar</md-button><md-button class="md-raised md-accient" ng-click="saveClip()">Guardar</md-button><md-button class="md-raised md-primary" ng-click="resetClip()">Nuevo</md-button></md-fab-actions></md-toolbar></md-card></div><div flex="33"><md-card><md-card-content flex  layout-padding><md-list><md-list-item class="md-3-line secondary-button-padding" ng-repeat="item in clips track by $index"ng-click="setSource(item,$index)"><img src="images/poster.jpg" class="md-avatar"/><div class="md-list-item-text" layout="column"><h3>{{ item.name }}</h3><p>Start ({{ item.startTime|secondsToHHmmss }}) -  End ({{item.endTime|secondsToHHmmss}})</p></div></md-list-item><md-divider ></md-divider></md-list></md-card-content></md-card></div></div></md-card>',controller:function(e,i,t,l,n,a){function o(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function r(i){if(-1!==e.$storage.clips.map(function(e){return e.id}).indexOf(i.id)){var t=e.$storage.clips.indexOf(i);i.persist===!1?e.$storage.clips.splice(t,1):e.$storage.clips[t]=i}else i.persist!==!1&&e.$storage.clips.push(i)}e.videosourceOrigin=e.videosource;var d=l.instances.get("myBlock");e.$storage=n.$default({clips:[]}),e.onPlay=0,e.resetClip=function(){e.clip={id:null,name:null,startTime:null,endTime:null,source:null,playFragment:null,persist:!1},e["new"]=!0},e["new"]=!0,e.resetClip(),e.clips=[],angular.element("#player").bind("loadeddata",function(){e.videoDuration=angular.element("#player")[0].duration,e.clips[0].endTime=e.videoDuration}),angular.element("#player").on("pause",function(){var i=e.clips.indexOf(e.clip);i<e.clips.length-1&&angular.element("#player")[0].currentTime-e.clip.endTime>.1&&(d.start("Loading next clip.."),t(function(){d.stop(),e.videosource=e.clips[i+1].playFragment},3e3))}),e.clips.push({id:o(),name:"Full Video",startTime:0,endTime:e.videoDuration,source:e.videosourceOrigin,playFragment:e.videosourceOrigin}),angular.forEach(e.$storage.clips,function(i){e.clips.push(i)}),e.saveClip=function(i){e.clip.source=e.videosource,e.clip.playFragment=e.videosourceOrigin+"#t="+e.clip.startTime+","+e.clip.endTime,e["new"]===!0?(e.clip.id=o(),e.clips.push(e.clip),r(e.clip),e.resetClip()):r(e.clip)},e.deleteClip=function(){var i=e.onPlay;e.clips[i].persist=!1,r(e.clips[i]),e.clips.splice(i,1),e.resetClip()},e.setSource=function(i,t){e.videosource=i.playFragment,e.onPlay=t,0!==t?(e.clip=i,e["new"]=!1):e.resetClip()},a.add({combo:"ctrl+up",description:"Next",callback:function(){e.onPlay<e.clips.length-1&&(e.videosource=e.clips[e.onPlay+=1].playFragment)}}),a.add({combo:"ctrl+down",description:"Preview",callback:function(){e.onPlay>0&&(e.videosource=e.clips[e.onPlay-=1].playFragment)}})},link:function(e,i,t){}}}),angular.module("slpaVideoPlayer.filters",[]).filter("secondsToHHmmss",function(e){return function(i){return e("date")(new Date(0,0,0).setSeconds(i),"HH:mm:ss")}}).filter("trustUrl",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),angular.module("slpaVideoPlayer.services",[]).factory("localData",function(e){});